From 3d6cdd28e0e890fd587d11f1c4195cb9ab00aa63 Mon Sep 17 00:00:00 2001
From: Jarl-Penguin <jarlpenguin@outlook.com>
Date: Wed, 23 Feb 2022 15:31:08 +0100
Subject: [PATCH] soong: Add TARGET_QCOM_NO_FM_FIRMWARE conditional

[ItsVixano: Frontport to lineage-20]
Signed-off-by: Jarl-Penguin <jarlpenguin@outlook.com>
Change-Id: I83cbf855839a57c3506f0d8b6c538224a2a148e3
---
 build/soong/Android.bp     | 17 +++++++++++++++++
 config/BoardConfigSoong.mk |  2 ++
 2 files changed, 19 insertions(+)

diff --git a/build/soong/Android.bp b/build/soong/Android.bp
index 870d3b73..aacbba13 100644
--- a/build/soong/Android.bp
+++ b/build/soong/Android.bp
@@ -257,3 +257,20 @@ surfaceflinger_qcom_extensions {
         },
     },
 }
+
+soong_config_module_type {
+    name: "qcom_no_fm_firmware",
+    module_type: "cc_defaults",
+    config_namespace: "lineageQcomVars",
+    bool_variables: ["qcom_no_fm_firmware"],
+    properties: ["cppflags"],
+}
+
+qcom_no_fm_firmware {
+    name: "qcom_no_fm_firmware_defaults",
+    soong_config_variables: {
+        qcom_no_fm_firmware: {
+            cppflags: ["-DQCOM_NO_FM_FIRMWARE"],
+        },
+    },
+}
diff --git a/config/BoardConfigSoong.mk b/config/BoardConfigSoong.mk
index 1556e2cf..5f7b22a3 100644
--- a/config/BoardConfigSoong.mk
+++ b/config/BoardConfigSoong.mk
@@ -44,6 +44,7 @@ SOONG_CONFIG_lineageNvidiaVars += \

 SOONG_CONFIG_NAMESPACES += lineageQcomVars
 SOONG_CONFIG_lineageQcomVars += \
+    qcom_no_fm_firmware \
     supports_extended_compress_format \
     uses_pre_uplink_features_netmgrd

@@ -57,6 +58,7 @@ endif
 SOONG_CONFIG_lineageGlobalVars_gralloc_handle_has_reserved_size := $(TARGET_GRALLOC_HANDLE_HAS_RESERVED_SIZE)
 SOONG_CONFIG_lineageGlobalVars_uses_egl_display_array := $(TARGET_USES_EGL_DISPLAY_ARRAY)
 SOONG_CONFIG_lineageNvidiaVars_uses_nvidia_enhancements := $(NV_ANDROID_FRAMEWORK_ENHANCEMENTS)
+SOONG_CONFIG_lineageQcomVars_qcom_no_fm_firmware := $(TARGET_QCOM_NO_FM_FIRMWARE)
 SOONG_CONFIG_lineageQcomVars_supports_extended_compress_format := $(AUDIO_FEATURE_ENABLED_EXTENDED_COMPRESS_FORMAT)
 SOONG_CONFIG_lineageQcomVars_uses_pre_uplink_features_netmgrd := $(TARGET_USES_PRE_UPLINK_FEATURES_NETMGRD)

--
2.34.1
