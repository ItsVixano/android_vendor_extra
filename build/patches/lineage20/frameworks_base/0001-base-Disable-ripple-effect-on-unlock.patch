From 5903345e9e1a1c605554864e0a2c09c32b8d06de Mon Sep 17 00:00:00 2001
From: Rishawn <70256146+Stealth1226@users.noreply.github.com>
Date: Mon, 10 Jan 2022 09:47:15 +0530
Subject: [PATCH] base: Disable ripple effect on unlock

    From: Nauval Rizky <enuma.alrizky@gmail.com>
    Date: Wed, 19 Jan 2022 08:31:56 +0700
    Subject: SystemUI: Fix method for disabling unlock ripple
     animation

    NotificationShadeWindowController's are not gracefully closed, which
    leads to top parts of the screen is being obscured by invisible shade window.
    And also, "ripple" is actually still exists due to lightRevealScrim are
    being started by onKeyguardFadingAwayChanged, which is not what user expect
    when they want to disable the effect.

    So in order to handle those cases, lets intercept it from the
    AuthRippleController instead.

    Signed-off-by: alanndz <alanndz7@gmail.com>
    Signed-off-by: Joey Huab <joey@evolution-x.org>
    Signed-off-by: Pranav Vashi <neobuddy89@gmail.com>

[ItsVixano]: Hard disable it :D

Change-Id: Icf288401b6695bc1866d379028402fb7d953f11e
---
 .../android/systemui/biometrics/AuthRippleController.kt   | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/packages/SystemUI/src/com/android/systemui/biometrics/AuthRippleController.kt b/packages/SystemUI/src/com/android/systemui/biometrics/AuthRippleController.kt
index 38fab8ffbfad..204fe07615f8 100644
--- a/packages/SystemUI/src/com/android/systemui/biometrics/AuthRippleController.kt
+++ b/packages/SystemUI/src/com/android/systemui/biometrics/AuthRippleController.kt
@@ -160,6 +160,8 @@ class AuthRippleController @Inject constructor(
     }
 
     private fun showUnlockedRipple() {
+        return
+
         notificationShadeWindowController.setForcePluginOpen(true, this)
         val lightRevealScrim = centralSurfaces.lightRevealScrim
         if (statusBarStateController.isDozing || biometricUnlockController.isWakeAndUnlock) {
@@ -179,6 +181,12 @@ class AuthRippleController @Inject constructor(
     }
 
     override fun onKeyguardFadingAwayChanged() {
+        // reset and hide the scrim so it doesn't appears on
+        // the next notification shade usage
+        centralSurfaces.lightRevealScrim?.revealAmount = 1f
+        startLightRevealScrimOnKeyguardFadingAway = false
+        return
+
         if (keyguardStateController.isKeyguardFadingAway) {
             val lightRevealScrim = centralSurfaces.lightRevealScrim
             if (startLightRevealScrimOnKeyguardFadingAway && lightRevealScrim != null) {
-- 
2.34.1

